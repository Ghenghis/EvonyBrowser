<UserControl x:Class="SvonyBrowser.Controls.TrafficViewer"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:SvonyBrowser.Controls"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800"
             Background="#1E1E2E">
    
    <UserControl.Resources>
        <SolidColorBrush x:Key="BackgroundBrush" Color="#1E1E2E"/>
        <SolidColorBrush x:Key="SurfaceBrush" Color="#2D2D3D"/>
        <SolidColorBrush x:Key="TextPrimaryBrush" Color="#F8FAFC"/>
        <SolidColorBrush x:Key="TextSecondaryBrush" Color="#94A3B8"/>
        <SolidColorBrush x:Key="BorderBrush" Color="#3D3D4D"/>
        <SolidColorBrush x:Key="RequestBrush" Color="#3B82F6"/>
        <SolidColorBrush x:Key="ResponseBrush" Color="#10B981"/>
        <SolidColorBrush x:Key="ErrorBrush" Color="#EF4444"/>
        
        <!-- DataGrid Style -->
        <Style TargetType="DataGrid">
            <Setter Property="Background" Value="{StaticResource BackgroundBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="GridLinesVisibility" Value="Horizontal"/>
            <Setter Property="HorizontalGridLinesBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="RowBackground" Value="Transparent"/>
            <Setter Property="AlternatingRowBackground" Value="#252535"/>
        </Style>
        
        <Style TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="{StaticResource SurfaceBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
        </Style>
        
        <Style TargetType="DataGridCell">
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DataGridCell">
                        <Border Background="{TemplateBinding Background}"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#3D3D5D"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="200"/>
        </Grid.RowDefinitions>
        
        <!-- Toolbar -->
        <Border Grid.Row="0" 
                Background="{StaticResource SurfaceBrush}"
                Padding="12,8"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="0,0,0,1">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- Controls -->
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <Button x:Name="StartCaptureButton"
                            Content="â–¶ Start"
                            Click="StartCapture_Click"
                            Padding="12,6"
                            Margin="0,0,8,0"/>
                    <Button x:Name="StopCaptureButton"
                            Content="â¹ Stop"
                            Click="StopCapture_Click"
                            Padding="12,6"
                            Margin="0,0,8,0"
                            IsEnabled="False"/>
                    <Button Content="ðŸ—‘ Clear"
                            Click="ClearTraffic_Click"
                            Padding="12,6"
                            Margin="0,0,8,0"/>
                    <Button Content="ðŸ’¾ Export"
                            Click="ExportTraffic_Click"
                            Padding="12,6"/>
                </StackPanel>
                
                <!-- Filter -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center">
                    <TextBlock Text="Filter:" 
                               Foreground="{StaticResource TextSecondaryBrush}"
                               VerticalAlignment="Center"
                               Margin="0,0,8,0"/>
                    <TextBox x:Name="FilterTextBox"
                             Width="200"
                             Background="{StaticResource BackgroundBrush}"
                             Foreground="{StaticResource TextPrimaryBrush}"
                             BorderBrush="{StaticResource BorderBrush}"
                             Padding="8,4"
                             TextChanged="FilterTextBox_TextChanged"/>
                    <ComboBox x:Name="DirectionFilter"
                              Width="100"
                              Margin="8,0,0,0"
                              SelectionChanged="DirectionFilter_SelectionChanged">
                        <ComboBoxItem Content="All" IsSelected="True"/>
                        <ComboBoxItem Content="Requests"/>
                        <ComboBoxItem Content="Responses"/>
                    </ComboBox>
                </StackPanel>
                
                <!-- Status -->
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <TextBlock x:Name="StatusText"
                               Text="Idle"
                               Foreground="{StaticResource TextSecondaryBrush}"
                               VerticalAlignment="Center"
                               Margin="0,0,8,0"/>
                    <TextBlock x:Name="CountText"
                               Text="0 entries"
                               Foreground="{StaticResource TextSecondaryBrush}"
                               VerticalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Traffic List -->
        <DataGrid Grid.Row="1"
                  x:Name="TrafficDataGrid"
                  AutoGenerateColumns="False"
                  IsReadOnly="True"
                  SelectionMode="Single"
                  SelectionChanged="TrafficDataGrid_SelectionChanged"
                  CanUserAddRows="False"
                  CanUserDeleteRows="False"
                  HeadersVisibility="Column">
            <DataGrid.Columns>
                <DataGridTextColumn Header="Time" Binding="{Binding TimestampFormatted}" Width="80"/>
                <DataGridTemplateColumn Header="Dir" Width="50">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding DirectionIcon}"
                                       Foreground="{Binding DirectionBrush}"
                                       FontWeight="Bold"
                                       HorizontalAlignment="Center"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTextColumn Header="Action" Binding="{Binding Action}" Width="200"/>
                <DataGridTextColumn Header="URL" Binding="{Binding Url}" Width="*"/>
                <DataGridTextColumn Header="Size" Binding="{Binding SizeFormatted}" Width="80"/>
                <DataGridTextColumn Header="Status" Binding="{Binding StatusCode}" Width="60"/>
            </DataGrid.Columns>
        </DataGrid>
        
        <!-- Splitter -->
        <GridSplitter Grid.Row="2" 
                      Height="4" 
                      HorizontalAlignment="Stretch"
                      Background="{StaticResource BorderBrush}"/>
        
        <!-- Details Panel -->
        <TabControl Grid.Row="3"
                    Background="{StaticResource BackgroundBrush}"
                    BorderBrush="{StaticResource BorderBrush}">
            <TabItem Header="Decoded">
                <ScrollViewer>
                    <TextBox x:Name="DecodedTextBox"
                             IsReadOnly="True"
                             TextWrapping="Wrap"
                             Background="{StaticResource BackgroundBrush}"
                             Foreground="{StaticResource TextPrimaryBrush}"
                             BorderThickness="0"
                             FontFamily="Consolas"
                             FontSize="12"
                             Padding="12"/>
                </ScrollViewer>
            </TabItem>
            <TabItem Header="Raw Hex">
                <ScrollViewer>
                    <TextBox x:Name="RawHexTextBox"
                             IsReadOnly="True"
                             TextWrapping="Wrap"
                             Background="{StaticResource BackgroundBrush}"
                             Foreground="{StaticResource TextSecondaryBrush}"
                             BorderThickness="0"
                             FontFamily="Consolas"
                             FontSize="11"
                             Padding="12"/>
                </ScrollViewer>
            </TabItem>
            <TabItem Header="Headers">
                <ScrollViewer>
                    <TextBox x:Name="HeadersTextBox"
                             IsReadOnly="True"
                             TextWrapping="Wrap"
                             Background="{StaticResource BackgroundBrush}"
                             Foreground="{StaticResource TextPrimaryBrush}"
                             BorderThickness="0"
                             FontFamily="Consolas"
                             FontSize="12"
                             Padding="12"/>
                </ScrollViewer>
            </TabItem>
        </TabControl>
    </Grid>
</UserControl>
