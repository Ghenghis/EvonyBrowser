<UserControl x:Class="SvonyBrowser.Controls.ChatbotPanel"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:SvonyBrowser.Controls"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="400"
             Background="#1E1E2E">
    
    <UserControl.Resources>
        <!-- Color Palette -->
        <SolidColorBrush x:Key="BackgroundBrush" Color="#1E1E2E"/>
        <SolidColorBrush x:Key="SurfaceBrush" Color="#2D2D3D"/>
        <SolidColorBrush x:Key="PrimaryBrush" Color="#7C3AED"/>
        <SolidColorBrush x:Key="SecondaryBrush" Color="#10B981"/>
        <SolidColorBrush x:Key="TextPrimaryBrush" Color="#F8FAFC"/>
        <SolidColorBrush x:Key="TextSecondaryBrush" Color="#94A3B8"/>
        <SolidColorBrush x:Key="BorderBrush" Color="#3D3D4D"/>
        <SolidColorBrush x:Key="UserMessageBrush" Color="#3B82F6"/>
        <SolidColorBrush x:Key="AssistantMessageBrush" Color="#374151"/>
        <SolidColorBrush x:Key="ErrorBrush" Color="#EF4444"/>
        
        <!-- Message Bubble Style -->
        <Style x:Key="MessageBubbleStyle" TargetType="Border">
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Margin" Value="8,4"/>
            <Setter Property="MaxWidth" Value="320"/>
        </Style>
        
        <!-- Input TextBox Style -->
        <Style x:Key="InputTextBoxStyle" TargetType="TextBox">
            <Setter Property="Background" Value="{StaticResource SurfaceBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="12,10"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="CaretBrush" Value="{StaticResource TextPrimaryBrush}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="8">
                            <ScrollViewer x:Name="PART_ContentHost" 
                                          Margin="{TemplateBinding Padding}"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Send Button Style -->
        <Style x:Key="SendButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource PrimaryBrush}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="16,10"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                CornerRadius="8"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" 
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#8B5CF6"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#6D28D9"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="border" Property="Background" Value="#4B5563"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Quick Action Button Style -->
        <Style x:Key="QuickActionButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="6"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" 
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource SurfaceBrush}"/>
                                <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Message Template -->
        <DataTemplate x:Key="MessageTemplate">
            <Grid Margin="0,4">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <Border Style="{StaticResource MessageBubbleStyle}"
                        HorizontalAlignment="{Binding HorizontalAlignment}"
                        Background="{Binding BackgroundBrush}">
                    <StackPanel>
                        <!-- Message Content -->
                        <TextBlock Text="{Binding Content}"
                                   Foreground="{StaticResource TextPrimaryBrush}"
                                   TextWrapping="Wrap"
                                   FontSize="14"
                                   LineHeight="20"/>
                        
                        <!-- Timestamp and Sources -->
                        <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                            <TextBlock Text="{Binding TimestampFormatted}"
                                       Foreground="{StaticResource TextSecondaryBrush}"
                                       FontSize="10"/>
                            <TextBlock Text="{Binding SourcesFormatted}"
                                       Foreground="{StaticResource SecondaryBrush}"
                                       FontSize="10"
                                       Margin="8,0,0,0"
                                       Visibility="{Binding HasSources, Converter={StaticResource BoolToVisibilityConverter}}"/>
                        </StackPanel>
                    </StackPanel>
                </Border>
            </Grid>
        </DataTemplate>
    </UserControl.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <Border Grid.Row="0" 
                Background="{StaticResource SurfaceBrush}"
                Padding="16,12"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="0,0,0,1">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- Icon -->
                <Border Grid.Column="0" 
                        Width="36" Height="36" 
                        CornerRadius="18"
                        Background="{StaticResource PrimaryBrush}">
                    <TextBlock Text="ðŸ¤–" 
                               FontSize="18"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"/>
                </Border>
                
                <!-- Title -->
                <StackPanel Grid.Column="1" Margin="12,0,0,0" VerticalAlignment="Center">
                    <TextBlock Text="Evony Co-Pilot"
                               Foreground="{StaticResource TextPrimaryBrush}"
                               FontSize="16"
                               FontWeight="SemiBold"/>
                    <TextBlock x:Name="StatusText"
                               Text="Ready"
                               Foreground="{StaticResource SecondaryBrush}"
                               FontSize="12"/>
                </StackPanel>
                
                <!-- Menu Button -->
                <Button Grid.Column="2" 
                        Style="{StaticResource QuickActionButtonStyle}"
                        Click="MenuButton_Click"
                        ToolTip="Options">
                    <TextBlock Text="â‹®" FontSize="16"/>
                </Button>
            </Grid>
        </Border>
        
        <!-- Messages Area -->
        <ScrollViewer Grid.Row="1" 
                      x:Name="MessagesScrollViewer"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled"
                      Padding="8">
            <ItemsControl x:Name="MessagesItemsControl"
                          ItemTemplate="{StaticResource MessageTemplate}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
            </ItemsControl>
        </ScrollViewer>
        
        <!-- Quick Actions -->
        <Border Grid.Row="2"
                Background="{StaticResource SurfaceBrush}"
                Padding="8"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="0,1,0,0">
            <ScrollViewer HorizontalScrollBarVisibility="Auto" 
                          VerticalScrollBarVisibility="Disabled">
                <StackPanel Orientation="Horizontal">
                    <Button Style="{StaticResource QuickActionButtonStyle}"
                            Content="ðŸ“Š Protocol Lookup"
                            Click="QuickAction_ProtocolLookup"
                            Margin="0,0,8,0"/>
                    <Button Style="{StaticResource QuickActionButtonStyle}"
                            Content="ðŸ§® Calculator"
                            Click="QuickAction_Calculator"
                            Margin="0,0,8,0"/>
                    <Button Style="{StaticResource QuickActionButtonStyle}"
                            Content="ðŸ“¡ Traffic"
                            Click="QuickAction_Traffic"
                            Margin="0,0,8,0"/>
                    <Button Style="{StaticResource QuickActionButtonStyle}"
                            Content="ðŸ“š Knowledge"
                            Click="QuickAction_Knowledge"
                            Margin="0,0,8,0"/>
                    <Button Style="{StaticResource QuickActionButtonStyle}"
                            Content="ðŸ”§ Build Order"
                            Click="QuickAction_BuildOrder"/>
                </StackPanel>
            </ScrollViewer>
        </Border>
        
        <!-- Input Area -->
        <Border Grid.Row="3"
                Background="{StaticResource SurfaceBrush}"
                Padding="12"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="0,1,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBox x:Name="InputTextBox"
                         Grid.Column="0"
                         Style="{StaticResource InputTextBoxStyle}"
                         AcceptsReturn="False"
                         TextWrapping="Wrap"
                         MaxHeight="100"
                         VerticalScrollBarVisibility="Auto"
                         KeyDown="InputTextBox_KeyDown">
                    <TextBox.InputBindings>
                        <KeyBinding Key="Enter" Command="{Binding SendCommand}"/>
                    </TextBox.InputBindings>
                </TextBox>
                
                <Button x:Name="SendButton"
                        Grid.Column="1"
                        Style="{StaticResource SendButtonStyle}"
                        Content="Send"
                        Margin="8,0,0,0"
                        Click="SendButton_Click"/>
            </Grid>
        </Border>
        
        <!-- Loading Overlay -->
        <Border x:Name="LoadingOverlay"
                Grid.RowSpan="4"
                Background="#80000000"
                Visibility="Collapsed">
            <StackPanel HorizontalAlignment="Center" 
                        VerticalAlignment="Center">
                <TextBlock Text="â³"
                           FontSize="32"
                           HorizontalAlignment="Center">
                    <TextBlock.RenderTransform>
                        <RotateTransform x:Name="LoadingRotation" CenterX="16" CenterY="16"/>
                    </TextBlock.RenderTransform>
                </TextBlock>
                <TextBlock Text="Thinking..."
                           Foreground="{StaticResource TextPrimaryBrush}"
                           FontSize="14"
                           Margin="0,8,0,0"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
